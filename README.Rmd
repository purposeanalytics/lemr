---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "80%",
  dpi = 300
)
options(tibble.max_extra_cols = 20)
ggplot2::theme_set(ggplot2::theme_minimal())
```

# lemur

CMHC Housing Supply Challenge Proof of Concept

## Installation

You can install lemur from GitHub:

``` r
# install.packages("devtools")
devtools::install_github("purposeanalytics/lemur")
```

The next section discusses usage of the package for _users_ of lemur. For information on the _development_, please skip ahead to the "Development" section.

## Usage

### App

The primary product of lemur is a Shiny app which will show low-end of market rental housing in Toronto, along with other data sets. To load the app, run:

```r
lemur::run_app()
```

### Functions

lemur also contains a few utility functions.

For example, you can geocode addresses using the Bing geocoder:

```{r}
library(lemur)
geocode_address("220 Yonge St Toronto ON")
```

This looks up any address in Canada, so it's helpful to supply the city or postal code for the most accurate results - for example, 220 Yonge St without "Toronto ON" gives us somewhere on an island in Lake Huron:

```{r}
geocode_address("220 Yonge St")
```

An API token is required, and the function looks for it in the `BING_TOKEN` environment variable, buit this can be changed or supplied directly via the `token` argument.

### Data sets

lemur contains a number of spatial data sets (used in the app), which can also be used in other code or packages.

#### toronto

toronto is a data set that includes the boundary of Toronto:

```{r}
library(sf)
library(ggplot2)
toronto

p <- ggplot() + 
  geom_sf(data = toronto)

p
```

#### neighbourhoods

neighbourhoods contains the 140 social planning neighbourhoods in Toronto and their boundaries. Once the [new 158 neighbourhoods](https://www.toronto.ca/city-government/data-research-maps/neighbourhoods-communities/neighbourhood-profiles/) are released by the City of Toronto, this data set will be updated.

```{r}
neighbourhoods

p <- p +
  geom_sf(data = neighbourhoods)

p
```
 
#### apartment_building_registry

apartment_building_registry is a geocoded version of the City of Toronto's [Apartment Building Registration Dataset](https://open.toronto.ca/dataset/apartment-building-registration/), with cleaned addresses and latitude and longitude:

```{r}
apartment_building_registry

p + 
  geom_point(data = apartment_building_registry, aes(x = bing_longitude, y = bing_latitude))
```

## Development

To add to lemur code or work within the package repository itself, first clone the repository and open the project in RStudio.

### renv

This package uses [`renv`](https://rstudio.github.io/renv/articles/renv.html) for managing dependencies during the _development_ of lemur and to ensure package versions stay consistent, on your own machine and across other machines. `renv` isolates dependencies so that e.g. the set of (and versions of) libraries used in the development of `lemur` can be different than the libraries used in your other analyses. 

This [article about collaborating with `renv`](https://rstudio.github.io/renv/articles/collaborating.html) outlines the steps for collaborating with `renv`. The setup has already been done, so the key is step #4 under "Collaborating with renv":

> When a collaborator first launches in this project, renv should automatically bootstrap itself, thereby downloading and installing the appropriate version of renv into the project library. After this has completed, they can then use `renv::restore()` to restore the project library locally on their machine.

So, fingers crossed, all you need to do is `renv::restore()` and `renv` will install all the correct packages and versions for you!

### Loading, developing, and updating code

The [`devtools`](https://devtools.r-lib.org) package is a package developer's best friend! It contains all the needed functions to load, document, test, etc a package.

In particular, `devtools::load_all()` "simulates installing and reloading your package", and so it loads all R code in `R/` as well as any data files in `data/`, allowing you to access all functions and data without really "installing" the package.

So to load the package and launch the app, you load the package, then use the `run_app()` function:

```{r, eval = FALSE}
devtools::load_all(".")
# â„¹ Loading lemur
run_app()
```

If you make changes to the app, or any other functions / data, just `devtools::load_all(".")` again and relaunch! Particularly useful is the _shortcut_ for `load_all()`, `control + shift + l` (that's an L), which is well-worked into my muscle memory :)

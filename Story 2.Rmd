---
title: "Stories2"
date: "9/21/2021"
output:
  pdf_document: default
  html_document: default
always_allow_html: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message=FALSE)
```

```{r library}
library(dplyr)
library(readr)
library(ggplot2)
library(lemur)
library(tidyr)
```

# proximity to services

```{r}
# amenity density
adn <- amenity_density_by_neighbourhood %>% pivot_wider(names_from = amenity_dense, values_from = proportion)
```

```{r}
# rental supply
rsn <- rental_supply_by_neighbourhood %>% select(-prop_group) %>% pivot_wider(names_from = group, values_from = c(prop))
```

```{r}
# low end of market breakdown
lem <- neighbourhood_aggregate %>% purrr::transpose() %>% purrr::pluck("lem") %>% 
  bind_rows(.id = "neighbourhood") %>% 
  pivot_wider(names_from = Bedrooms, values_from = c(`Deeply Affordable`, `Very Affordable`, `Total`), names_repair = 'minimal')
```

```{r}
# number of buildings
nb <- neighbourhood_aggregate %>% purrr::transpose() %>% purrr::pluck("number_of_buildings") %>% 
  bind_rows(.id = "neighbourhood") %>% 
  pivot_longer(cols = everything()) %>% rename(neighbourhood = name, number_of_buildings = value)
```

```{r}
# total income
ati <- neighbourhood_aggregate %>% purrr::transpose() %>% purrr::pluck("average_total_income") %>% 
  bind_rows(.id = "neighbourhood") %>% 
  pivot_wider(names_from = group, values_from = c(value))
```

```{r}
# unaffordable percent
uh <- neighbourhood_aggregate %>% purrr::transpose() %>% purrr::pluck("unaffordable_housing") %>% 
  bind_rows(.id = "neighbourhood") %>% 
  pivot_longer(cols = everything()) %>% rename(neighbourhood = name, unaffordable_housing = value)
```

```{r}
# average shelter cost
arsc <- neighbourhood_aggregate %>% purrr::transpose() %>% purrr::pluck("average_renter_shelter_cost") %>% 
  bind_rows(.id = "neighbourhood") %>% 
  pivot_longer(cols = everything()) %>% rename(neighbourhood = name, average_renter_shelter_cost = value) 
```

```{r dataset}
proximity_layers <- adn %>% 
  inner_join(arsc, by = 'neighbourhood') %>% 
  inner_join(ati, by = 'neighbourhood') %>% 
  inner_join(lem, by = 'neighbourhood') %>% 
  inner_join(nb, by = 'neighbourhood') %>% 
  inner_join(rsn, by = 'neighbourhood') %>% 
  inner_join(uh, by = 'neighbourhood')
```

```{r}
test <- proximity_layers %>% select(neighbourhood, High, Medium, Low,average_renter_shelter_cost,Condo) %>% 
  pivot_longer(cols = c(High, Medium, Low))
```


```{r}
plotly::ggplotly(
  ggplot(test, aes(value, Condo, colour = average_renter_shelter_cost)) +
    geom_point(size = 3) +
    ggrepel::geom_label_repel(data = test, aes(label=neighbourhood), size= 2.5) +
    #scale_color_manual(values = c("TRUE" = "#08569a", "FALSE" = "grey")) +
    facet_wrap(~name) +
    theme_bw()+
    theme(legend.position = 'None')
    )
```


```{r}
```

